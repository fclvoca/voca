<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스마트 단어장</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --primary: #007bff;
            --danger: #dc3545;
            --text-main: #333;
        }

        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); margin: 0; padding: 10px; }
        
        /* Header & Navigation */
        .header { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; padding: 10px; background: var(--card-bg); border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; position: sticky; top: 0; z-index: 100; }
        .nav-top { display: flex; width: 100%; justify-content: space-between; align-items: center; }
        select, input, button { padding: 8px 12px; border-radius: 8px; border: 1px solid #ddd; font-size: 14px; }
        .search-area { display: flex; flex-grow: 1; gap: 5px; }
        .search-area input { flex-grow: 1; }
        
        /* Buttons */
        .btn-toggle { background: #6c757d; color: white; cursor: pointer; }
        .btn-admin { background: #343a40; color: white; }
        
        /* Word List */
        .word-list { display: flex; flex-direction: column; gap: 10px; }
        .word-item { display: flex; align-items: center; background: var(--card-bg); padding: 12px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        .status-btn { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #ddd; margin-right: 12px; cursor: pointer; flex-shrink: 0; }
        .status-blue { background: #007bff; border-color: #007bff; }
        .status-red { background: #dc3545; border-color: #dc3545; }
        
        .word-content { flex-grow: 1; cursor: pointer; }
        .word-eng { font-weight: bold; font-size: 18px; color: var(--primary); }
        .word-phonetic { font-size: 13px; color: #777; margin-top: 2px; }
        
        .word-meaning { flex-basis: 40%; text-align: right; font-size: 16px; color: var(--text-main); cursor: pointer; min-height: 24px; transition: opacity 0.2s; }
        .hidden { opacity: 0; }

        /* Admin Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; }
        .modal-content { background: white; width: 90%; max-width: 500px; margin: 50px auto; padding: 20px; border-radius: 15px; max-height: 80vh; overflow-y: auto; }
        textarea { width: 100%; height: 200px; margin: 10px 0; border-radius: 8px; padding: 10px; box-sizing: border-box; }
        
        /* Settings Bar */
        .settings-bar { display: flex; align-items: center; gap: 10px; font-size: 12px; color: #555; margin-bottom: 10px; }
        input[type="range"] { vertical-align: middle; }
    </style>
</head>
<body>

<div class="header">
    <div class="nav-top">
        <select id="bookSelect" onchange="changeBook()"></select>
        <button class="btn-admin" onclick="openAdmin()">관리자</button>
    </div>
    <div class="search-area">
        <input type="text" id="searchInput" placeholder="단어 검색..." oninput="renderWords()">
        <button class="btn-toggle" onclick="toggleAllMeanings()">뜻 보임/숨김</button>
    </div>
    <div class="settings-bar">
        발음 속도: <input type="range" id="speechRate" min="0.5" max="1.5" step="0.1" value="1.0">
    </div>
</div>

<div id="wordList" class="word-list"></div>

<div id="adminModal" class="modal">
    <div class="modal-content">
        <h3>단어장 관리자</h3>
        <div style="display: flex; gap: 5px; margin-bottom: 15px;">
            <input type="text" id="newBookName" placeholder="새 단어장 이름">
            <button onclick="addBook()">추가</button>
            <button style="background: var(--danger); color: white;" onclick="deleteBook()">삭제</button>
        </div>
        <hr>
        <h4>일괄 등록/수정</h4>
        <p style="font-size: 12px; color: #666;">형식: 단어 [발음] 뜻 (한 줄에 하나씩)</p>
        <textarea id="bulkInput" placeholder="tradition [trəˈdɪʃən] 전통, 전설"></textarea>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button onclick="closeAdmin()">취소</button>
            <button class="btn-admin" onclick="saveBulkData()">저장하기</button>
        </div>
    </div>
</div>

<script>
    let vocabulary = JSON.parse(localStorage.getItem('fcl_voca')) || {
        "기본 단어장": [
            {eng: "tradition", phonetic: "[trəˈdɪʃən]", mean: "전통, 전설", status: 0}
        ]
    };
    
    let currentBook = Object.keys(vocabulary)[0];
    let showMeanings = true;

    // 초기 실행
    function init() {
        updateBookSelect();
        renderWords();
    }

    function updateBookSelect() {
        const select = document.getElementById('bookSelect');
        select.innerHTML = Object.keys(vocabulary).map(name => 
            `<option value="${name}" ${name === currentBook ? 'selected' : ''}>${name}</option>`
        ).join('');
    }

    function changeBook() {
        currentBook = document.getElementById('bookSelect').value;
        renderWords();
    }

    function renderWords() {
        const list = document.getElementById('wordList');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const words = vocabulary[currentBook];
        
        list.innerHTML = words
            .filter(w => w.eng.toLowerCase().includes(searchTerm) || w.mean.includes(searchTerm))
            .map((w, index) => `
            <div class="word-item">
                <div class="status-btn ${w.status === 1 ? 'status-blue' : w.status === 2 ? 'status-red' : ''}" 
                     onclick="toggleStatus(${index})"></div>
                <div class="word-content" onclick="speak('${w.eng}')">
                    <div class="word-eng">${w.eng}</div>
                    <div class="word-phonetic">${w.phonetic}</div>
                </div>
                <div class="word-meaning ${showMeanings ? '' : 'hidden'}" onclick="toggleSingleMeaning(this)">
                    ${w.mean}
                </div>
            </div>
        `).join('');
    }

    // 상태 변경 (파랑 -> 빨강 -> 기본)
    function toggleStatus(index) {
        vocabulary[currentBook][index].status = (vocabulary[currentBook][index].status + 1) % 3;
        saveData();
        renderWords();
    }

    // 뜻 전체 보임/숨김
    function toggleAllMeanings() {
        showMeanings = !showMeanings;
        renderWords();
    }

    // 개별 뜻 보기
    function toggleSingleMeaning(el) {
        el.classList.toggle('hidden');
    }

    // TTS 발음 기능
    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = document.getElementById('speechRate').value;
        window.speechSynthesis.speak(utterance);
    }

    // 관리자 모드 로직
    function openAdmin() {
        document.getElementById('adminModal').style.display = 'block';
        const words = vocabulary[currentBook];
        document.getElementById('bulkInput').value = words.map(w => `${w.eng} ${w.phonetic} ${w.mean}`).join('\n');
    }

    function closeAdmin() {
        document.getElementById('adminModal').style.display = 'none';
    }

    function saveBulkData() {
        const input = document.getElementById('bulkInput').value.trim();
        const lines = input.split('\n');
        const newWords = lines.map(line => {
            const match = line.match(/^(.+?)\s+(\[.+?\])\s+(.+)$/);
            if(match) {
                return { eng: match[1].trim(), phonetic: match[2].trim(), mean: match[3].trim(), status: 0 };
            }
            return null;
        }).filter(w => w !== null);

        vocabulary[currentBook] = newWords;
        saveData();
        renderWords();
        closeAdmin();
    }

    function addBook() {
        const name = document.getElementById('newBookName').value.trim();
        if(name && !vocabulary[name]) {
            vocabulary[name] = [];
            currentBook = name;
            saveData();
            updateBookSelect();
            renderWords();
            document.getElementById('newBookName').value = '';
        }
    }

    function deleteBook() {
        if(Object.keys(vocabulary).length <= 1) return alert("최소 하나의 단어장은 있어야 합니다.");
        if(confirm(`${currentBook}을(를) 삭제하시겠습니까?`)) {
            delete vocabulary[currentBook];
            currentBook = Object.keys(vocabulary)[0];
            saveData();
            updateBookSelect();
            renderWords();
        }
    }

    function saveData() {
        localStorage.setItem('fcl_voca', JSON.stringify(vocabulary));
    }

    init();
</script>

</body>
</html>
