<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FCL Premium Smart Voca</title>
    <style>
        /* ì„ ìƒë‹˜ì˜ ê¸°ì¡´ ë””ìì¸ ìœ ì§€ */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        :root { --fcl-navy: #1A237E; --fcl-orange: #FF9800; --fcl-red: #EF4444; --fcl-bg: #F5F7F9; --text-dark: #1E293B; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--fcl-bg); margin: 0; padding: 0; color: var(--text-dark); }
        .sticky-header { position: sticky; top: 0; z-index: 1000; background-color: var(--fcl-navy); padding: 12px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.15); color: white; }
        .word-item { background: white; margin: 10px; border-radius: 15px; display: flex; align-items: center; padding: 18px; border: 1px solid #EDF2F7; box-shadow: 0 3px 6px rgba(0,0,0,0.05); }
        .word-info { flex: 1; display: flex; flex-direction: column; gap: 5px; }
        .eng-text { font-weight: 900; font-size: 22px; color: #0F172A; cursor: pointer; }
        .pro-text { font-size: 14px; color: #64748B; font-weight: 500; }
        .kor-text { color: #0F172A; font-weight: 700; background: #F8FAFC; padding: 14px; border-radius: 12px; min-width: 110px; text-align: center; border: 1px solid #E2E8F0; cursor: pointer; }
        .kor-text.hidden { background: #EDF2F7 !important; color: transparent !important; }
        
        /* ê´€ë¦¬ì íŒ¨ë„ */
        #adminPanel { display: none; background: white; padding: 25px; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; z-index: 3000; border: 3px solid var(--fcl-navy); border-radius: 20px; box-shadow: 0 25px 60px rgba(0,0,0,0.6); }
    </style>
</head>
<body onclick="unlockAudio();">

<div class="sticky-header">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <div id="currentBookTitle" style="font-weight:900; font-size:18px;">ë‹¨ì–´ì¥ ì„ íƒ ì¤‘...</div>
        <button onclick="askAdmin()" style="background:none; border:none; color:rgba(255,255,255,0.4); font-size:20px; cursor:pointer;">âš™ï¸</button>
    </div>
    <div style="margin-top:12px; display:flex; gap:8px;">
        <button onclick="toggleHide()" id="hideBtn" style="flex:1; background:var(--fcl-orange); color:white; border:none; padding:10px; border-radius:8px; font-weight:700;">ëœ» ìˆ¨ê¸°ê¸°</button>
        <button onclick="toggleShuffle()" id="shuffleBtn" style="flex:1; background:#22C55E; color:white; border:none; padding:10px; border-radius:8px; font-weight:700;">ìˆœì„œ ì„ê¸°</button>
    </div>
</div>

<div id="wordDisplay" class="word-list"></div>

<div id="adminPanel">
    <h3 style="color:var(--fcl-navy); margin-top:0;">ğŸ“‚ ê´€ë¦¬ì ì‹œìŠ¤í…œ</h3>
    <div id="adminStats" style="background:#f1f5f9; padding:15px; border-radius:10px; margin-bottom:15px; font-weight:700;"></div>
    <p style="font-size:13px; color:#64748B;">ë‹¨ì–´ ì¶”ê°€/ì‚­ì œ ë° ì´ë¦„ ìˆ˜ì •ì€ ì•„ë˜ ë§ˆìŠ¤í„° ì‹œíŠ¸ì—ì„œ ì§„í–‰í•´ ì£¼ì„¸ìš”.</p>
    <button onclick="window.open('https://docs.google.com/spreadsheets/d/1v9K-3mPjEofw67OaAnp29pXFmD7hWwX-S1qD1N5D-3E/edit')" style="width:100%; padding:15px; background:var(--fcl-orange); color:white; border:none; border-radius:10px; font-weight:800; cursor:pointer; margin-bottom:10px;">ë§ˆìŠ¤í„° ì‹œíŠ¸ ë°”ë¡œê°€ê¸°</button>
    <button onclick="closeAdmin()" style="width:100%; padding:15px; background:#64748B; color:white; border:none; border-radius:10px; font-weight:800; cursor:pointer;">ê´€ë¦¬ì ì¢…ë£Œ</button>
</div>

<script>
    const adminPw = "5857";
    const MASTER_API_URL = "https://script.google.com/macros/s/AKfycbxUK5Tu8pTpKEwddPT2gMxgY95wGLbTl_GsVeaZgH1eRH5jVSYBgS7qrbHnawsl4gzY/exec";
    
    let vocaBooks = []; let allWords = []; let hideAll = false; let isShuffled = false;
    let synth = window.speechSynthesis; let audioUnlocked = false;

    async function initApp() {
        try {
            const res = await fetch(MASTER_API_URL + "?v=" + Date.now());
            vocaBooks = await res.json();
            if (vocaBooks.length > 0) {
                document.getElementById('currentBookTitle').innerText = vocaBooks[0].name;
                loadData(vocaBooks[0].url);
            }
        } catch (e) { console.error(e); }
    }

    async function loadData(url) {
        try {
            const res = await fetch(url + "?v=" + Date.now());
            const data = await res.json();
            // [ì¤‘ìš” ìˆ˜ì •] ì—´ ì´ë¦„ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ê°ì²´ì˜ ê°’ ìˆœì„œë¡œ ì§ì ‘ ë§¤í•‘í•©ë‹ˆë‹¤.
            allWords = data.map(v => {
                const values = Object.values(v); 
                return {
                    eng: values[0] || "", // Aì—´: ì˜ì–´
                    pro: values[1] || "", // Bì—´: ë°œìŒê¸°í˜¸
                    kor: values[2] || ""  // Cì—´: í•œê¸€ ëœ»
                };
            });
            drawUI();
        } catch (e) { console.error(e); }
    }

    function drawUI() {
        const disp = document.getElementById('wordDisplay'); disp.innerHTML = "";
        let displayList = isShuffled ? [...allWords].sort(() => Math.random() - 0.5) : allWords;

        displayList.forEach(w => {
            const div = document.createElement('div'); div.className = 'word-item';
            div.innerHTML = `
                <div class="word-info">
                    <span class="eng-text" onclick="play('${w.eng.replace(/'/g,"\\'")}')">${w.eng}</span>
                    <span class="pro-text">${w.pro}</span>
                </div>
                <div class="kor-text ${hideAll?'hidden':''}" onclick="this.classList.toggle('hidden')">${w.kor}</div>
            `;
            disp.appendChild(div);
        });
    }

    function askAdmin() {
        if(prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.") === adminPw) {
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('adminStats').innerHTML = `í˜„ì¬ ë‹¨ì–´ì¥: ${document.getElementById('currentBookTitle').innerText}<br>ì´ ë“±ë¡ ë‹¨ì–´: ${allWords.length}ê°œ`;
        }
    }

    function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
    function toggleHide() { hideAll = !hideAll; document.getElementById('hideBtn').innerText = hideAll ? "ëœ» ë³´ì´ê¸°" : "ëœ» ìˆ¨ê¸°ê¸°"; drawUI(); }
    function toggleShuffle() { isShuffled = !isShuffled; document.getElementById('shuffleBtn').innerText = isShuffled ? "ê¸°ë³¸ ì •ë ¬" : "ìˆœì„œ ì„ê¸°"; drawUI(); }
    function unlockAudio() { if (!audioUnlocked) { synth.speak(new SpeechSynthesisUtterance("")); audioUnlocked = true; } }
    function play(t) { synth.cancel(); const m = new SpeechSynthesisUtterance(t); m.lang = 'en-US'; synth.speak(m); }

    initApp();
</script>
</body>
</html>
