<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FCL Premium Multi Voca</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap');
        :root { --fcl-navy: #1A237E; --fcl-orange: #FF9800; --fcl-bg: #F5F7F9; --text-dark: #1E293B; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: var(--fcl-bg); margin: 0; padding: 0; color: var(--text-dark); letter-spacing: -0.5px; }
        
        /* Î°úÎπÑ ÌôîÎ©¥ (Îã®Ïñ¥Ïû• ÏÑ†ÌÉù) */
        #lobby { display: flex; flex-direction: column; align-items: center; padding: 40px 20px; text-align: center; }
        .lobby-logo { font-size: 28px; font-weight: 900; color: var(--fcl-navy); margin-bottom: 30px; }
        .voca-card { background: white; width: 100%; max-width: 400px; padding: 20px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .voca-card:hover { border-color: var(--fcl-navy); transform: translateY(-3px); }
        .voca-card h3 { margin: 0; font-size: 18px; color: var(--text-dark); }
        .voca-card p { margin: 5px 0 0; font-size: 13px; color: #64748B; }

        /* Î©îÏù∏ ÌïôÏäµ ÌôîÎ©¥ */
        #mainApp { display: none; }
        .sticky-header { position: sticky; top: 0; z-index: 1000; background-color: var(--fcl-navy); padding: 12px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .top-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 12px; }
        .voca-title { color: white; font-weight: 900; font-size: 16px; display: flex; align-items: center; gap: 5px; }
        .btn-home { background: rgba(255,255,255,0.2); color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px; cursor: pointer; }
        .btn-hide { background-color: var(--fcl-orange); color: white; border: none; padding: 0 12px; height: 34px; border-radius: 6px; font-weight: 700; cursor: pointer; font-size: 13px; }
        .btn-admin-gear { background: none; border: none; color: rgba(255,255,255,0.4); font-size: 20px; cursor: pointer; }
        
        /* Ìà¥Î∞î (3Î∞∞ Í∏¥ ÏÜçÎèÑÏ°∞Ï†à Î∞î Ìè¨Ìï®) */
        .tool-row { display: flex; flex-direction: column; gap: 12px; width: 100%; }
        .tool-line { display: flex; align-items: center; gap: 8px; width: 100%; }
        .search-input { flex: 1; height: 34px; padding: 0 10px; border-radius: 6px; border: none; font-size: 13px; outline: none; }
        .voice-select { flex: 1.5; height: 34px; border-radius: 6px; border: none; font-size: 12px; background: white; outline: none; padding: 0 5px; font-weight: 700; color: #1A237E; }
        .speed-control { display: flex; align-items: center; gap: 10px; color: white; font-size: 13px; width: 100%; background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 8px; }
        .speed-slider { flex: 1; height: 8px; accent-color: var(--fcl-orange); cursor: pointer; }
        .font-control { display: flex; align-items: center; gap: 5px; color: white; font-size: 12px; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px; }
        .font-btn { background: white; border: none; width: 22px; height: 22px; border-radius: 4px; font-weight: 900; color: var(--fcl-navy); cursor: pointer; }

        /* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò Î∞è Î¶¨Ïä§Ìä∏ */
        .page-wrapper { padding: 15px 10px; background: white; border-bottom: 1px solid #E2E8F0; }
        .page-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; }
        .p-btn { min-width: 42px; height: 42px; border: 1px solid #E2E8F0; background: white; border-radius: 8px; font-size: 16px; font-weight: 900; cursor: pointer; }
        .p-btn.active { background-color: var(--fcl-navy); color: white; }
        .word-list { padding: 10px 8px; }
        .word-item { background: white; margin-bottom: 8px; border-radius: 12px; display: flex; align-items: center; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #EDF2F7; }
        .check-circle { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #CBD5E0; margin-right: 15px; cursor: pointer; }
        .check-circle.active { background: var(--fcl-orange); border-color: var(--fcl-orange); }
        .word-info { flex: 1; display: flex; flex-direction: column; align-items: flex-start; gap: 6px; cursor: pointer; }
        .eng-text { font-weight: 900; color: #0F172A; }
        .kor-text { color: #0F172A; font-weight: 700; background: #F8FAFC; padding: 12px; border-radius: 10px; min-width: 100px; text-align: center; border: 1px solid #E2E8F0; }
        .kor-text.hidden { background: #EDF2F7 !important; color: transparent !important; }

        /* Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê */
        #adminPanel { display: none; background: white; padding: 20px; position: fixed; top: 10px; left: 10px; right: 10px; z-index: 3000; border: 3px solid var(--fcl-navy); border-radius: 15px; max-height: 90vh; overflow-y: auto; }
        .stat-tabs { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-btn { flex: 1; padding: 8px; font-size: 11px; font-weight: 800; border: 1px solid #ddd; background: #fff; border-radius: 6px; }
        .tab-btn.active { background: var(--fcl-navy); color: white; }
        .voca-edit-item { background: #f1f5f9; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
    </style>
</head>
<body onclick="unlockAudio()">

<div id="lobby">
    <div class="lobby-logo">FCL Premium Voca</div>
    <div id="vocaListContainer" style="width: 100%;">
        </div>
</div>

<div id="mainApp">
    <div class="sticky-header">
        <div class="top-row">
            <div class="voca-title">
                <button class="btn-home" onclick="goHome()">üè† Ìôà</button>
                <span id="currentVocaTitle">Îã®Ïñ¥Ïû•</span>
            </div>
            <div style="display:flex; gap:8px; align-items:center;">
                <button onclick="toggleHide()" class="btn-hide" id="hideBtn">Îúª Ïà®Í∏∞Í∏∞</button>
                <button onclick="askAdmin()" class="btn-admin-gear">‚öôÔ∏è</button>
            </div>
        </div>
        <div class="tool-row">
            <div class="tool-line">
                <input type="text" id="wordSearch" class="search-input" placeholder="Í≤ÄÏÉâ..." oninput="searchWord()">
                <select id="voiceSelect" class="voice-select" onchange="saveVoiceSetting()"></select>
            </div>
            <div class="speed-control">
                <span>Speed</span>
                <input type="range" id="rateRange" class="speed-slider" min="0.4" max="1.2" step="0.1" value="0.8">
                <div class="font-control"><button class="font-btn" onclick="changeFontSize(-2)">-</button><span>A</span><button class="font-btn" onclick="changeFontSize(2)">+</button></div>
            </div>
        </div>
    </div>
    <div class="page-wrapper"><div id="pageBtns" class="page-container"></div></div>
    <div id="wordDisplay" class="word-list"></div>
</div>

<div id="adminPanel">
    <div style="font-weight:900; color:var(--fcl-navy); margin-bottom:15px; text-align:center;">üìä Í¥ÄÎ¶¨Ïûê ÌÜµÌï© Ï†úÏñ¥</div>
    
    <div class="stat-tabs">
        <button class="tab-btn active" onclick="showStat('day', this)">ÏùºÍ∞Ñ</button>
        <button class="tab-btn" onclick="showStat('week', this)">Ï£ºÍ∞Ñ</button>
        <button class="tab-btn" onclick="showStat('month', this)">ÏõîÍ∞Ñ</button>
        <button class="tab-btn" onclick="showStat('year', this)">Ïó∞Í∞Ñ</button>
    </div>
    <div style="background:#f8fafc; padding:15px; border-radius:10px; text-align:center; margin-bottom:20px; border:1px solid #e2e8f0;">
        <small id="statLabel">Ïò§Îäò Î∞©Î¨∏Ïûê Ïàò</small><br>
        <b id="statValue" style="font-size:24px; color:var(--fcl-navy);">0</b> Î™Ö
    </div>

    <div style="font-weight:900; font-size:15px; margin-bottom:10px; color:var(--fcl-navy);">‚úèÔ∏è Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• Ïù¥Î¶Ñ ÏàòÏ†ï</div>
    <div id="adminVocaList">
        </div>
    
    <button onclick="closeAdmin()" style="width:100%; padding:15px; background:var(--fcl-navy); color:white; border:none; border-radius:10px; font-weight:800; margin-top:10px;">Í¥ÄÎ¶¨Ïûê Ï¢ÖÎ£å</button>
</div>

<script>
    const API = "https://script.google.com/macros/s/AKfycbxKOMLlSkyVPgEjmpRO0njboqqUjrhO8IRrGZMWrQ9ToTRBRfaHfz2I8mukDt7LrdwO/exec";
    
    // Îã®Ïñ¥Ïû• Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞
    let vocaBooks = JSON.parse(localStorage.getItem('fcl_books')) || [
        { id: 1, name: "Í≥†Íµê ÌïÑÏàò ÏòÅÎã®Ïñ¥ 1000", desc: "Í≥†Îì±ÌïôÍµê ÌïµÏã¨ Ïñ¥Ìúò Î™®Ïùå" },
        { id: 2, name: "ÏàòÎä• ÎåÄÎπÑ Ïã¨Ìôî Îã®Ïñ¥", desc: "ÏàòÎä• 1Îì±Í∏âÏùÑ ÏúÑÌïú ÌïÑÏàò Îã®Ïñ¥" },
        { id: 3, name: "Ï∂îÍ∞Ä Îã®Ïñ¥Ïû• (ÏûëÏÑ±Ï§ë)", desc: "ÏÉàÎ°úÏö¥ Ïñ¥ÌúòÎ•º Ï∂îÍ∞ÄÌï† ÏòàÏ†ïÏûÖÎãàÎã§" }
    ];

    let currentBookId = null;
    let allWords = []; let nowPage = 1; const perPage = 50; const groupSize = 10;
    let hideAll = false; let currentFontSize = 22; const adminPw = "5857";
    let synth = window.speechSynthesis; let voices = []; let audioUnlocked = false;

    // Î°úÎπÑ Í∑∏Î¶¨Í∏∞
    function drawLobby() {
        const container = document.getElementById('vocaListContainer');
        container.innerHTML = "";
        vocaBooks.forEach(book => {
            const card = document.createElement('div');
            card.className = 'voca-card';
            card.innerHTML = `<h3>${book.name}</h3><p>${book.desc}</p>`;
            card.onclick = () => selectBook(book.id);
            container.appendChild(card);
        });
        document.getElementById('lobby').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    }

    // Îã®Ïñ¥Ïû• ÏÑ†ÌÉù
    async function selectBook(id) {
        currentBookId = id;
        const book = vocaBooks.find(b => b.id === id);
        document.getElementById('currentVocaTitle').innerText = book.name;
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        trackVisitor(id);
        loadData();
    }

    function goHome() { drawLobby(); }

    // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    async function loadData() {
        document.getElementById('wordDisplay').innerHTML = "<div style='text-align:center; padding:50px;'>Îã®Ïñ¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>";
        try {
            const res = await fetch(API + "?v=" + Date.now());
            const data = await res.json();
            allWords = data.map(v => ({ eng: v.english, kor: v.korean, pro: v.pronunciation || "" }));
            drawUI();
            loadVoices();
        } catch (e) { document.getElementById('wordDisplay').innerHTML = "Î°úÎî© Ïã§Ìå®"; }
    }

    // Í¥ÄÎ¶¨ÏûêÏö© Îã®Ïñ¥Ïû• Î¶¨Ïä§Ìä∏
    function drawAdminVocaList() {
        const container = document.getElementById('adminVocaList');
        container.innerHTML = "";
        vocaBooks.forEach((book, index) => {
            const div = document.createElement('div');
            div.className = 'voca-edit-item';
            div.innerHTML = `
                <input type="text" value="${book.name}" id="vName${index}" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:5px; margin-bottom:5px;">
                <button onclick="saveVocaName(${index})" style="width:100%; padding:8px; background:var(--fcl-orange); color:white; border:none; border-radius:5px; font-weight:700;">Ïù¥Î¶Ñ ÏàòÏ†ï</button>
            `;
            container.appendChild(div);
        });
    }

    function saveVocaName(index) {
        const newName = document.getElementById(`vName${index}`).value.trim();
        if(newName) {
            vocaBooks[index].name = newName;
            localStorage.setItem('fcl_books', JSON.stringify(vocaBooks));
            alert('Îã®Ïñ¥Ïû• Ïù¥Î¶ÑÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.');
            drawAdminVocaList();
            drawLobby();
        }
    }

    // Î∞©Î¨∏ ÌÜµÍ≥Ñ (Îã®Ïñ¥Ïû•Î≥Ñ Íµ¨Î∂Ñ)
    function trackVisitor(bookId) {
        const now = new Date();
        const d = now.toISOString().split('T')[0];
        const stats = JSON.parse(localStorage.getItem(`fcl_stats_${bookId}`) || '{"day":{},"week":{},"month":{},"year":{}}');
        stats.day[d] = (stats.day[d] || 0) + 1;
        localStorage.setItem(`fcl_stats_${bookId}`, JSON.stringify(stats));
    }

    function showStat(type, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const stats = JSON.parse(localStorage.getItem(`fcl_stats_${currentBookId}`) || '{"day":{},"week":{},"month":{},"year":{}}');
        const now = new Date();
        const d = now.toISOString().split('T')[0];
        document.getElementById('statValue').innerText = (stats.day[d] || 1).toLocaleString();
    }

    // Í∏∞Ï°¥ UI Î°úÏßÅ (Ïú†ÏßÄ)
    function drawUI() { drawWords(); drawPages(); }
    function drawWords() {
        const display = document.getElementById('wordDisplay'); display.innerHTML = "";
        allWords.slice((nowPage-1)*perPage, nowPage*perPage).forEach(w => {
            const div = document.createElement('div'); div.className = 'word-item';
            div.innerHTML = `
                <div class="check-circle" onclick="this.classList.toggle('active')"></div>
                <div class="word-info">
                    <span class="eng-text" style="font-size:${currentFontSize}px" onclick="play('${w.eng.replace(/'/g,"\\'")}')">${w.eng}</span>
                </div>
                <div class="kor-text ${hideAll?'hidden':''}" style="font-size:${currentFontSize-4}px" onclick="this.classList.toggle('hidden')">${w.kor}</div>`;
            display.appendChild(div);
        });
    }

    function drawPages() {
        const container = document.getElementById('pageBtns'); container.innerHTML = "";
        const totalP = Math.ceil(allWords.length / perPage);
        const startP = (Math.ceil(nowPage/groupSize)-1)*groupSize+1;
        const endP = Math.min(totalP, startP + groupSize - 1);
        for(let i=startP; i<=endP; i++) {
            const b = document.createElement('button'); b.className = 'p-btn '+(i===nowPage?'active':''); b.innerText = i;
            b.onclick = () => { nowPage=i; drawUI(); window.scrollTo(0,0); }; container.appendChild(b);
        }
    }

    function askAdmin() { if(prompt("ÎπÑÎ∞ÄÎ≤àÌò∏") === adminPw) { drawAdminVocaList(); document.getElementById('adminPanel').style.display = 'block'; } }
    function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
    function changeFontSize(d) { currentFontSize = Math.min(Math.max(currentFontSize + d, 14), 36); drawWords(); }
    function toggleHide() { hideAll=!hideAll; document.getElementById('hideBtn').innerText = hideAll?"Îúª Î≥¥Ïù¥Í∏∞":"Îúª Ïà®Í∏∞Í∏∞"; drawWords(); }
    function unlockAudio() { if (!audioUnlocked) { new Audio().play().catch(()=>{}); audioUnlocked = true; } }
    function loadVoices() {
        voices = synth.getVoices();
        const vSelect = document.getElementById('voiceSelect');
        const enVoices = voices.filter(v => v.lang.startsWith('en'));
        vSelect.innerHTML = "";
        enVoices.forEach((v, i) => {
            const opt = document.createElement('option'); opt.value = i;
            opt.innerText = v.name; vSelect.appendChild(opt);
        });
    }
    function play(t) {
        synth.cancel(); const msg = new SpeechSynthesisUtterance(t);
        msg.rate = document.getElementById('rateRange').value; synth.speak(msg);
    }
    drawLobby();
</script>
</body>
</html>
