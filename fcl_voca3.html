<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FCL Smart Voca Premium</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');

        :root {
            /* ë³´ë‚´ì£¼ì‹  ì´ë¯¸ì§€ì˜ ë‚¨ìƒ‰ ë°°ê²½ìƒ‰ ì¶”ì¶œ ë°˜ì˜ */
            --bg-deep-blue: #253483; 
            /* ëœ» ìˆ¨ê¸°ê¸° ë²„íŠ¼ì˜ ì˜¤ë Œì§€ìƒ‰ ë°˜ì˜ */
            --btn-orange: #FF9800;
            --primary-blue: #4A90E2;
            --card-white: #FFFFFF;
            --text-dark: #2C3E50;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-deep-blue); /* ìš”ì²­í•˜ì‹  ë‚¨ìƒ‰ ë°°ê²½ */
            color: var(--text-dark);
            margin: 0; padding: 0; 
        }

        .container { max-width: 600px; margin: 0 auto; padding-bottom: 40px; }

        /* [Header ì„¹ì…˜] */
        .header { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 15px; 
            position: sticky; top: 0; z-index: 1000; 
            box-shadow: var(--shadow);
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        .top-row { display: flex; gap: 10px; align-items: center; margin-bottom: 12px; }
        .voca-select { 
            flex: 1; padding: 0 15px; height: 45px;
            border-radius: 12px; border: 2px solid #E2E8F0;
            font-weight: 700; font-size: 16px; background: #FFF; outline: none;
        }

        .btn-setting { 
            background: #F1F5F9; border: none; width: 45px; height: 45px;
            border-radius: 12px; cursor: pointer; font-size: 22px;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        .btn-setting:active { transform: rotate(45deg); }

        /* [ë„êµ¬ í–‰: í™•ì¥ëœ ê²€ìƒ‰ì°½ & ì˜¤ë Œì§€ìƒ‰ ë²„íŠ¼] */
        .tool-row { display: flex; gap: 10px; align-items: center; }
        .search-input { 
            width: 230px; height: 45px; padding: 0 15px;
            border-radius: 12px; border: 1px solid #CBD5E0;
            font-size: 15px; background: #F8FAFC; outline: none;
        }

        .btn-hide { 
            background: var(--btn-orange); /* ìš”ì²­í•˜ì‹  ì˜¤ë Œì§€ìƒ‰ */
            color: white; border: none; 
            padding: 0 20px; border-radius: 12px; font-size: 15px; 
            font-weight: 800; height: 45px; white-space: nowrap; cursor: pointer;
            box-shadow: 0 4px 0px #E68A00;
        }
        .btn-hide:active { transform: translateY(2px); box-shadow: none; }

        .speed-box { flex: 1; display: flex; align-items: center; gap: 8px; }
        .speed-box input[type="range"] { flex: 1; accent-color: var(--primary-blue); cursor: pointer; }

        /* [í˜ì´ì§€ë„¤ì´ì…˜] */
        .page-wrapper { padding: 20px 5mm; text-align: center; }
        .page-container { display: flex; justify-content: space-between; gap: 4px; }
        .p-btn { 
            flex: 1; height: 48px; border: none; 
            background: rgba(255,255,255,0.15); color: #FFF;
            border-radius: 10px; cursor: pointer; font-size: 16px; 
            font-weight: 700; transition: 0.2s;
        }
        .p-btn.active { background: var(--btn-orange); color: white; transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* [ê´€ë¦¬ì íŒ¨ë„: ë‹¨ì–´ì¥ ì¶”ê°€/ì‚­ì œ ê¸°ëŠ¥ ë³µêµ¬] */
        .setting-panel { 
            display: none; background: #FFF; padding: 20px; 
            margin: 15px; border-radius: 20px; border: none;
            box-shadow: var(--shadow);
        }
        .setting-panel.show { display: block; animation: slideDown 0.3s ease-out; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { background: #F8FAFC; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #E2E8F0; }
        .stat-label { font-size: 12px; color: #64748B; display: block; margin-bottom: 5px; }
        .stat-value { font-size: 20px; font-weight: 800; color: var(--bg-deep-blue); }

        .admin-box { margin-top: 15px; border-top: 2px dashed #E2E8F0; padding-top: 15px; }
        .admin-label { font-size: 14px; font-weight: 800; color: var(--text-dark); display: block; margin-bottom: 10px; }
        .input-row { display: flex; gap: 8px; margin-bottom: 10px; }
        .input-row input { flex: 1; padding: 12px; border: 1px solid #CBD5E0; border-radius: 10px; outline: none; }
        
        .btn-add { background: var(--primary-blue); color: white; border: none; padding: 0 15px; border-radius: 10px; font-weight: 700; cursor: pointer; }
        .btn-del { background: #FF5252; color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; margin-top: 5px; }

        /* [ë‹¨ì–´ ë¦¬ìŠ¤íŠ¸] */
        .word-list { padding: 15px; }
        .word-item { 
            display: grid; grid-template-columns: 45px 1.2fr 1fr; 
            align-items: center; background: var(--card-white); padding: 20px; 
            margin-bottom: 15px; border-radius: 18px; gap: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .check-btn { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #E2E8F0; cursor: pointer; }
        .check-btn.blue { background: var(--primary-blue); border-color: var(--primary-blue); }
        .check-btn.red { background: #FF5252; border-color: #FF5252; }

        .eng-text { font-size: 22px; font-weight: 800; color: #1E293B; display: block; letter-spacing: -0.5px; }
        .pro-text { font-size: 15px; color: #94A3B8; display: block; margin-top: 5px; font-style: italic; }

        .kor-box { 
            padding: 15px 10px; background: #F8FAFC; color: #000; 
            font-weight: 800; text-align: center; cursor: pointer; 
            border-radius: 15px; font-size: 17px; border: 1px solid #E2E8F0;
            min-height: 24px;
        }
        .hidden { background: #E2E8F0 !important; color: transparent !important; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="top-row">
            <select id="vocaSelect" class="voca-select" onchange="changeVoca()">
                <option value="0">ğŸ“– FCL ê³ ë“± í•„ìˆ˜ ì˜ë‹¨ì–´</option>
            </select>
            <button onclick="toggleSet()" class="btn-setting">âš™ï¸</button>
        </div>
        
        <div class="tool-row">
            <input type="text" id="wordSearch" class="search-input" placeholder="ì´ë™í•  ë‹¨ì–´ ê²€ìƒ‰..." oninput="searchWord()">
            <button onclick="toggleHide()" id="hideBtn" class="btn-hide">ëœ» ìˆ¨ê¸°ê¸°</button>
            <div class="speed-box">
                <input type="range" id="rateRange" min="0.4" max="1.1" step="0.1" value="0.8">
            </div>
        </div>
    </div>

    <div class="page-wrapper">
        <div id="pageBtns" class="page-container"></div>
    </div>

    <div id="setPanel" class="setting-panel">
        <div class="stat-grid">
            <div class="stat-card">
                <span class="stat-label">ì˜¤ëŠ˜ ë°©ë¬¸ì</span>
                <span id="visitCount" class="stat-value">128</span>ëª…
            </div>
            <div class="stat-card">
                <span class="stat-label">í‰ê·  í•™ìŠµì‹œê°„</span>
                <span id="avgTime" class="stat-value">12</span>ë¶„
            </div>
        </div>

        <div class="admin-box">
            <span class="admin-label">ë‹¨ì–´ì¥ ì¶”ê°€ ë° ê´€ë¦¬</span>
            <div class="input-row">
                <input type="text" id="vocaInput" placeholder="ìƒˆ ë‹¨ì–´ì¥ ì´ë¦„ ì…ë ¥...">
                <button onclick="addVoca()" class="btn-add">ì¶”ê°€</button>
            </div>
            <button onclick="deleteVoca()" class="btn-del">í˜„ì¬ ì„ íƒëœ ë‹¨ì–´ì¥ ì‚­ì œ</button>
        </div>
    </div>

    <div id="wordDisplay" class="word-list"></div>
</div>

<script>
    const API = "https://script.google.com/macros/s/AKfycbxKOMLlSkyVPgEjmpRO0njboqqUjrhO8IRrGZMWrQ9ToTRBRfaHfz2I8mukDt7LrdwO/exec";
    let allWords = [];
    let nowPage = 1;
    const perPage = 50;
    let hideAll = false;

    // í†µê³„ ì‹œë®¬ë ˆì´ì…˜ìš©
    let startTime = Date.now();

    async function init() {
        const display = document.getElementById('wordDisplay');
        display.innerHTML = "<div style='text-align:center; padding:50px; color:white;'>ğŸ“š ë‹¨ì–´ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>";
        try {
            const res = await fetch(API + "?v=" + Date.now());
            const data = await res.json();
            allWords = data.map(v => ({ eng: v.english, kor: v.korean, pro: v.pronunciation, state: 'none' }));
            drawUI();
        } catch (e) {
            display.innerHTML = "<div style='text-align:center; padding:50px; color:white;'>âš ï¸ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>";
        }
    }

    function drawUI() {
        drawWords();
        drawPages();
    }

    function drawWords() {
        const display = document.getElementById('wordDisplay');
        display.innerHTML = "";
        const start = (nowPage - 1) * perPage;
        const slice = allWords.slice(start, start + perPage);

        slice.forEach((w, i) => {
            const realIdx = start + i;
            const div = document.createElement('div');
            div.className = 'word-item';
            div.innerHTML = `
                <div class="check-btn ${w.state}" onclick="toggleCheck(${realIdx})"></div>
                <div onclick="play('${w.eng.replace(/'/g, "\\'")}')" style="cursor:pointer">
                    <span class="eng-text">${w.eng}</span>
                    <span class="pro-text">${w.pro}</span>
                </div>
                <div class="kor-box ${hideAll ? 'hidden' : ''}" onclick="this.classList.toggle('hidden')">
                    ${w.kor}
                </div>
            `;
            display.appendChild(div);
        });
    }

    function drawPages() {
        const container = document.getElementById('pageBtns');
        container.innerHTML = "";
        const totalP = Math.ceil(allWords.length / perPage);
        const startP = Math.max(1, nowPage - 2);
        const endP = Math.min(totalP, startP + 4);

        for (let i = startP; i <= endP; i++) {
            const btn = document.createElement('button');
            btn.className = 'p-btn' + (i === nowPage ? ' active' : '');
            btn.innerText = i;
            btn.onclick = () => { nowPage = i; drawUI(); window.scrollTo({top:0, behavior:'smooth'}); };
            container.appendChild(btn);
        }
    }

    /* [ê´€ë¦¬ì ê¸°ëŠ¥ í•¨ìˆ˜] */
    function addVoca() {
        const name = document.getElementById('vocaInput').value.trim();
        if (!name) return alert("ë‹¨ì–´ì¥ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        const select = document.getElementById('vocaSelect');
        const option = new Option("ğŸ“– " + name, select.options.length);
        select.add(option);
        document.getElementById('vocaInput').value = "";
        alert("ìƒˆ ë‹¨ì–´ì¥ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function deleteVoca() {
        const select = document.getElementById('vocaSelect');
        if (select.options.length <= 1) return alert("ê¸°ë³¸ ë‹¨ì–´ì¥ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        if (confirm(`'${select.options[select.selectedIndex].text}' ë‹¨ì–´ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            select.remove(select.selectedIndex);
            alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
    }

    function toggleSet() {
        const panel = document.getElementById('setPanel');
        panel.classList.toggle('show');
        if (panel.classList.contains('show')) {
            // í†µê³„ ìˆ˜ì¹˜ ì—…ë°ì´íŠ¸ (ì˜ˆì‹œê°’)
            document.getElementById('avgTime').innerText = Math.floor((Date.now() - startTime) / 60000) + 12;
        }
    }

    function searchWord() {
        const val = document.getElementById('wordSearch').value.toLowerCase();
        if (!val) return;
        const idx = allWords.findIndex(v => v.eng.toLowerCase().includes(val));
        if (idx !== -1) {
            nowPage = Math.floor(idx / perPage) + 1;
            drawUI();
            setTimeout(() => {
                const items = document.getElementsByClassName('word-item');
                items[idx % perPage].scrollIntoView({ behavior: 'smooth', block: 'center' });
                items[idx % perPage].style.boxShadow = "0 0 20px var(--btn-orange)";
            }, 300);
        }
    }

    function play(t) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(t);
        m.lang = 'en-US';
        m.rate = document.getElementById('rateRange').value;
        window.speechSynthesis.speak(m);
    }

    function toggleHide() {
        hideAll = !hideAll;
        document.getElementById('hideBtn').innerText = hideAll ? "ëœ» ë³´ì´ê¸°" : "ëœ» ìˆ¨ê¸°ê¸°";
        drawWords();
    }

    function toggleCheck(i) {
        const s = allWords[i].state;
        allWords[i].state = (s === 'none') ? 'blue' : (s === 'blue') ? 'red' : 'none';
        drawWords();
    }

    init();
</script>
</body>
</html>
